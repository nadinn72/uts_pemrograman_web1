<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Transaksi - BookStore</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="tracking-page">
    <header class="page-header">
        <div class="container">
            <div class="header-content">
                <a href="dashboard.html" class="back-btn">‚Üê Kembali ke Dashboard</a>
                <div class="header-title">
                    <h1>History Transaksi</h1>
                    <p>Riwayat pemesanan dan pengiriman buku</p>
                </div>
            </div>
        </div>
    </header>

    <main class="page-main">
        <div class="container">
            <div class="history-container">
                <div class="history-filters">
                    <div class="filter-group">
                        <label for="statusFilter">Filter Status:</label>
                        <select id="statusFilter" onchange="filterHistory()">
                            <option value="all">Semua Status</option>
                            <option value="Dikirim">Dikirim</option>
                            <option value="Dalam Perjalanan">Dalam Perjalanan</option>
                            <option value="Selesai">Selesai</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="dateFilter">Filter Tanggal:</label>
                        <input type="month" id="dateFilter" onchange="filterHistory()">
                    </div>
                </div>

                <div class="history-list" id="historyList">
                    <!-- Daftar history akan diisi oleh JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Detail Tracking -->
    <div id="trackingDetailModal" class="modal">
        <div class="modal-content pink-modal">
            <span class="close">&times;</span>
            <div id="trackingDetailContent">
                <!-- Konten detail tracking akan diisi oleh JavaScript -->
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script>
        // Data history transaksi (dapat diperluas dengan data dari localStorage atau API)
        const historyData = [
            {
                id: "TRX001",
                tanggal: "2025-08-25",
                nomorDO: "20230012",
                customer: "Rina Wulandari",
                items: [
                    { nama: "Pengantar Ilmu Komunikasi", harga: "Rp 180.000", qty: 1 }
                ],
                total: "Rp 180.000",
                status: "Dalam Perjalanan",
                ekspedisi: "JNE",
                tracking: dataTracking["20230012"]
            },
            {
                id: "TRX002", 
                tanggal: "2025-08-25",
                nomorDO: "20230013",
                customer: "Agus Pranoto",
                items: [
                    { nama: "Manajemen Keuangan", harga: "Rp 220.000", qty: 1 }
                ],
                total: "Rp 220.000", 
                status: "Dikirim",
                ekspedisi: "Pos Indonesia",
                tracking: dataTracking["20230013"]
            },
            {
                id: "TRX003",
                tanggal: "2025-08-24", 
                customer: "Budi Santoso",
                items: [
                    { nama: "Kepemimpinan", harga: "Rp 150.000", qty: 1 },
                    { nama: "Pengantar Ilmu Komunikasi", harga: "Rp 180.000", qty: 1 }
                ],
                total: "Rp 330.000",
                status: "Selesai",
                ekspedisi: "TIKI",
                nomorDO: "20230014"
            },
            {
                id: "TRX004",
                tanggal: "2025-08-23",
                customer: "Sari Dewi",
                items: [
                    { nama: "Manajemen Keuangan", harga: "Rp 220.000", qty: 2 }
                ],
                total: "Rp 440.000",
                status: "Selesai", 
                ekspedisi: "JNE",
                nomorDO: "20230015"
            }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            displayHistory(historyData);
            
            // Close modal events
            document.querySelectorAll('.close').forEach(button => {
                button.addEventListener('click', function() {
                    document.getElementById('trackingDetailModal').style.display = 'none';
                });
            });

            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('trackingDetailModal')) {
                    document.getElementById('trackingDetailModal').style.display = 'none';
                }
            });
        });

        function displayHistory(data) {
            const historyList = document.getElementById('historyList');
            
            if (data.length === 0) {
                historyList.innerHTML = `
                    <div class="no-history">
                        <div class="placeholder-icon">üìù</div>
                        <h3>Tidak ada riwayat transaksi</h3>
                        <p>Belum ada transaksi yang dilakukan</p>
                    </div>
                `;
                return;
            }

            historyList.innerHTML = data.map(transaction => `
                <div class="history-card" onclick="showTrackingDetail('${transaction.nomorDO}')">
                    <div class="history-header">
                        <div class="history-info">
                            <h3>Transaksi #${transaction.id}</h3>
                            <p class="history-date">${formatDate(transaction.tanggal)}</p>
                        </div>
                        <div class="history-status status-${getStatusClass(transaction.status)}">
                            ${transaction.status}
                        </div>
                    </div>
                    
                    <div class="history-details">
                        <div class="detail-row">
                            <span class="detail-label">Customer:</span>
                            <span class="detail-value">${transaction.customer}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">No. DO:</span>
                            <span class="detail-value">${transaction.nomorDO || 'Belum tersedia'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ekspedisi:</span>
                            <span class="detail-value">${transaction.ekspedisi}</span>
                        </div>
                    </div>

                    <div class="history-items">
                        ${transaction.items.map(item => `
                            <div class="history-item">
                                <span class="item-name">${item.nama}</span>
                                <span class="item-price">${item.harga} x ${item.qty}</span>
                            </div>
                        `).join('')}
                    </div>

                    <div class="history-footer">
                        <div class="history-total">
                            Total: <strong>${transaction.total}</strong>
                        </div>
                        <button class="btn-track" onclick="event.stopPropagation(); showTrackingDetail('${transaction.nomorDO}')">
                            Lacak Pengiriman
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterHistory() {
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            let filteredData = historyData;

            // Filter berdasarkan status
            if (statusFilter !== 'all') {
                filteredData = filteredData.filter(transaction => 
                    transaction.status === statusFilter
                );
            }

            // Filter berdasarkan tanggal
            if (dateFilter) {
                filteredData = filteredData.filter(transaction => 
                    transaction.tanggal.startsWith(dateFilter)
                );
            }

            displayHistory(filteredData);
        }

        function showTrackingDetail(nomorDO) {
            const trackingData = dataTracking[nomorDO];
            
            if (!trackingData) {
                alert('Data tracking tidak ditemukan untuk nomor DO ini.');
                return;
            }

            const modalContent = document.getElementById('trackingDetailContent');
            modalContent.innerHTML = `
                <h2>Detail Tracking #${trackingData.nomorDO}</h2>
                
                <div class="tracking-info-card">
                    <div class="info-row">
                        <strong>Nomor DO:</strong>
                        <span>${trackingData.nomorDO}</span>
                    </div>
                    <div class="info-row">
                        <strong>Nama Penerima:</strong>
                        <span>${trackingData.nama}</span>
                    </div>
                    <div class="info-row">
                        <strong>Status:</strong>
                        <span class="status-${getStatusClass(trackingData.status)}">${trackingData.status}</span>
                    </div>
                    <div class="info-row">
                        <strong>Ekspedisi:</strong>
                        <span>${trackingData.ekspedisi}</span>
                    </div>
                    <div class="info-row">
                        <strong>Tanggal Kirim:</strong>
                        <span>${formatDate(trackingData.tanggalKirim)}</span>
                    </div>
                    <div class="info-row">
                        <strong>Nomor Paket:</strong>
                        <span>${trackingData.paket}</span>
                    </div>
                    <div class="info-row">
                        <strong>Total Pembayaran:</strong>
                        <span>${trackingData.total}</span>
                    </div>
                </div>

                <div class="tracking-timeline">
                    <h3>Riwayat Perjalanan</h3>
                    <div class="timeline">
                        ${trackingData.perjalanan.map((step, index) => `
                            <div class="timeline-step ${index === 0 ? 'step-active' : ''}">
                                <div class="step-icon">${index + 1}</div>
                                <div class="step-content">
                                    <h4>${step.keterangan}</h4>
                                    <p class="step-date">${formatDateTime(step.waktu)}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            document.getElementById('trackingDetailModal').style.display = 'block';
        }

        function getStatusClass(status) {
            switch(status) {
                case 'Selesai':
                case 'Dikirim':
                    return 'delivered';
                case 'Dalam Perjalanan':
                    return 'shipping';
                default:
                    return 'pending';
            }
        }

        function formatDate(dateString) {
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }

        function formatDateTime(dateTimeString) {
            const options = { 
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateTimeString).toLocaleDateString('id-ID', options);
        }

        // Global notification function
        function showNotification(message, type = 'success') {
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
            notification.innerHTML = `
                <span class="notification-icon">${icon}</span>
                <span class="notification-text">${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }
            }, 3000);
        }
    </script>

    <style>
        .history-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .history-filters {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--text-dark);
        }

        .filter-group select,
        .filter-group input {
            padding: 0.8rem;
            border: 2px solid var(--pastel-pink);
            border-radius: 8px;
            font-size: 1rem;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .history-card {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .history-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-pink);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .history-info h3 {
            color: var(--primary-pink);
            margin-bottom: 0.5rem;
        }

        .history-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .history-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .status-delivered {
            background: #d4edda;
            color: #155724;
        }

        .status-shipping {
            background: #fff3cd;
            color: #856404;
        }

        .status-pending {
            background: #cce7ff;
            color: #004085;
        }

        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--light-gray);
            border-radius: 10px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-dark);
        }

        .detail-value {
            color: var(--text-light);
        }

        .history-items {
            margin-bottom: 1rem;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--light-gray);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .item-name {
            color: var(--text-dark);
        }

        .item-price {
            color: var(--primary-pink);
            font-weight: 600;
        }

        .history-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 2px solid var(--pastel-pink);
        }

        .history-total {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-pink);
        }

        .btn-track {
            background: var(--primary-pink);
            color: var(--white);
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-track:hover {
            background: var(--light-pink);
            transform: translateY(-1px);
        }

        .no-history {
            text-align: center;
            padding: 3rem;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .no-history .placeholder-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .tracking-info-card {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1.5rem 0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid var(--medium-gray);
        }

        .info-row:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .tracking-timeline {
            margin-top: 2rem;
        }

        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline-step {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .timeline-step::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 30px;
            bottom: -20px;
            width: 2px;
            background: var(--light-gray);
        }

        .timeline-step:last-child::before {
            display: none;
        }

        .step-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--pastel-pink);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-pink);
            font-weight: bold;
            flex-shrink: 0;
            z-index: 1;
        }

        .step-active .step-icon {
            background: var(--primary-pink);
            color: var(--white);
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            color: var(--text-dark);
            margin-bottom: 0.3rem;
            font-size: 0.95rem;
        }

        .step-date {
            color: var(--text-light);
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            .history-filters {
                flex-direction: column;
                gap: 1rem;
            }

            .history-header {
                flex-direction: column;
                gap: 1rem;
            }

            .history-footer {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .btn-track {
                width: 100%;
            }

            .history-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>